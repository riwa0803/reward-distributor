# 報酬配布システム - README

## システム概要

報酬配布システムは、複数のブロックチェーン上でトークン報酬（ERC20/ERC721/ERC1155）をユーザーに配布するためのシステムです。アップグレード可能なプロキシパターンを採用し、AirdropIDとオンチェーンコミットメントによるセキュリティを強化しています。また、署名有効期限機能を追加して、より安全な報酬請求プロセスを実現しています。

### 主な機能

- 複数チェーン対応（クロスチェーン報酬配布）
- 複数種類のトークン対応（ERC20/ERC721/ERC1155）
- アップグレード可能なスマートコントラクト
- Airdropごとのグループ化と管理
- オンチェーンコミットメントによるセキュリティ強化
- 署名有効期限によるセキュリティ強化
- リトライメカニズムによる耐障害性

### アーキテクチャ

システムは以下のコンポーネントで構成されています：

1. **スマートコントラクト**
   - `RewardDistributorProxy`: 実装コントラクトへの呼び出しを委譲するプロキシ
   - `RewardDistributorProxyAdmin`: プロキシ管理用コントラクト
   - `RewardDistributor`: 報酬配布機能の実装コントラクト

2. **バックエンド**
   - データモデル: Airdrop、Asset、Reward等の構造定義
   - API実装: ブロックチェーンとの連携、署名生成等
   - イベントリスナー: コントラクトイベントの監視と処理
   - リトライメカニズム: 障害時の再処理機能

3. **フロントエンド**
   - 報酬表示コンポーネント
   - 報酬請求コンポーネント
   - 署名有効期限の視覚的表示

## セットアップ手順

1. スマートコントラクトのデプロイ
2. バックエンドのセットアップ
3. フロントエンドの構築
4. 各環境の設定とテスト

詳細な実装手順は「報酬配布システム - エンジニア向け実装指示書」を参照してください。

## 更新点

本システムは、前回の実装から以下の点を改善しています：

1. **AirdropIDの導入**
   - 複数の報酬をグループ化し、ユーザーへの表示を改善
   - バックエンドとブロックチェーン間の報酬連携を強化

2. **オンチェーンコミットメント**
   - 報酬パラメータのコミットメントをチェーン上に保存
   - 報酬請求時に検証することでセキュリティを強化

3. **署名有効期限機能**
   - 署名にタイムスタンプと有効期限を追加
   - 古い署名の悪用を防止する安全機能
   - フロントエンドでの視覚的な期限表示

4. **イベント処理の強化**
   - 見逃しイベント検出機能の追加
   - リトライメカニズムの改善

## 今後の展望

- マルチチェーン間の報酬集約機能
- バッチ処理によるガス最適化
- ユーザーエクスペリエンスのさらなる向上

## ファイル構成

```
reward-distribution-system/
├── contracts/                      # スマートコントラクト
│   ├── RewardDistributorProxy.sol
│   ├── RewardDistributorProxyAdmin.sol
│   └── RewardDistributor.sol
├── backend/                       # バックエンド
│   ├── src/
│   │   ├── api/                   # API実装
│   │   ├── models/                # データモデル
│   │   ├── services/              # サービス層
│   │   └── utils/                 # ユーティリティ
│   ├── scripts/                   # スクリプト
│   └── db/                        # データベース関連
├── frontend/                      # フロントエンド
│   ├── src/
│   │   ├── components/            # UI コンポーネント
│   │   ├── pages/                 # ページ
│   │   ├── services/              # API連携
│   │   └── utils/                 # ユーティリティ
│   └── public/                    # 静的ファイル
└── docs/                          # ドキュメント
    ├── implementation-guide.md    # 実装指示書
    └── api-docs.md                # API仕様書
```

## 依存パッケージ

### スマートコントラクト
- OpenZeppelin Contracts ^4.8.0
- Hardhat ^2.14.0

### バックエンド
- Node.js >= 16.x
- TypeScript ^4.9.5
- Express ^4.18.2
- Ethers.js ^5.7.2
- Knex.js ^2.4.2
- PostgreSQL >= 13

### フロントエンド
- React ^18.2.0
- TypeScript ^4.9.5
- ethers.js ^5.7.2
- Ant Design ^5.3.0
- date-fns ^2.29.3

## ライセンス

MIT License